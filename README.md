# pingcap 面试小作业

原题如下

> 内存中的行列结构的数据集，存在主键 k，求 TopN 算法
> 
> 上述题目在多核环境下的优化
> 
> 数据集大小为 1TB，分布规律未知。存储在某存储服务上，以 get(min_k, max_k) 接口获取数据，求多台服务器的计算方案


# 题目理解与疑问

首先尝试形式化定义原题，确保在实现前与题目原义对齐。这里使用 golang 作为实现语言。

## 约定

内存中的行列数据结构以行为数据记录单元，可以使用 key value pair 的形式表示，其中 key 为主键，value 为该行数据。由于需要求 TopN，因此所有行的集合形成一个*全序集*。暂且不考虑行数据的具体存储编码，将逻辑结构定义为

```go
type Record struct {
    key uint64  // 主键
    rank uint64  // 排序字段
    data []byte  // 其他数据
}
```

## 题目形式化定义

在以上约定的前提下，这里尝试将原题定义得更形式化，便于消除歧义。

### 题目

内存中有数据集 `data []Record`，两个 `Record` `R1` 和 `R2` 的排序等价于 `rank` 字段的排序，即 `R1 > R2` 当且仅当 `R1.rank > R2.rank`。基于以上定义，完成下列三道题目。

1. 设计单核情况下，查询 `data` 中最小的 `N` 个值的 TopN 算法。
2. 在多核情况下，优化 1 中的算法。
3. 考虑分布式情况：数据集大小为 1TB，分布规律未知，存储在某存储服务上。以 get(min_k, max_k) 接口获取数据，求 X 台服务器的计算方案。

### 疑问

1. 原题描述的行列数据
   1. 是否可以使用上述 `Record struct` 表示？
   2. 是否可以按照 `rank` 字段对其排序？
   3. 是否可以去掉 `data` 字段？
2. 分布式情况下，是否可以理解为：数据文件由服务 `DS (Data Service)` 管理，X 个计算节点使用 `get(min_k, max_k)` API 获取主键在 `[min_k, max_k)` 之间的数据，再汇总得到用户查询的 TopN？如果是这个意思的话，”分布规律未知“是指主键 k 的分布吗，比如主键空间是 0-1000，可能集中在 [0, 100] 和 [900, 1000] 两个区间的意思？
